<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Talking Dog: Royal Gold Edition</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Poppins:wght@300;600&display=swap');

        :root {
            --gold-light: #fcf6ba;
            --gold-mid: #bf953f;
            --gold-dark: #aa771c;
            --dark-bg: #101010;
            --glass: rgba(20, 20, 20, 0.85);
            --border: 1px solid rgba(191, 149, 63, 0.5);
        }

        body {
            margin: 0; overflow: hidden; background: #000;
            font-family: 'Poppins', sans-serif;
            color: var(--gold-light);
            touch-action: none; user-select: none;
        }

        canvas { display: block; width: 100%; height: 100%; }

        /* --- LUXURY UI --- */
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; display: flex; flex-direction: column;
            justify-content: space-between; z-index: 10;
        }

        /* TOP BAR */
        .header {
            padding: 20px; display: flex; justify-content: space-between; align-items: flex-start;
            pointer-events: auto; background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent);
        }

        .profile {
            display: flex; gap: 15px; align-items: center;
        }
        .vip-badge {
            width: 50px; height: 50px; border-radius: 50%;
            background: linear-gradient(135deg, var(--gold-light), var(--gold-dark));
            display: flex; align-items: center; justify-content: center;
            font-family: 'Cinzel', serif; font-weight: 700; color: #000;
            box-shadow: 0 0 15px var(--gold-mid); border: 2px solid white;
        }
        .stats-col { display: flex; flex-direction: column; gap: 5px; }
        
        .currency-box {
            background: var(--glass); border: var(--border);
            padding: 8px 15px; border-radius: 8px; font-size: 14px;
            display: flex; align-items: center; gap: 8px; backdrop-filter: blur(10px);
        }

        /* NEEDS BARS */
        .bars { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); display:flex; gap:5px; }
        .bar-pill { width: 8px; height: 40px; background: rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden; border: 1px solid #333; }
        .bar-fill { width: 100%; height: 100%; background: var(--gold-mid); transform-origin: bottom; transition: transform 0.5s; }

        /* DOCK */
        .dock {
            padding: 30px; display: flex; justify-content: center; gap: 25px;
            pointer-events: auto; background: linear-gradient(to top, #000, transparent);
        }

        .gold-btn {
            width: 70px; height: 70px; border-radius: 20px;
            background: linear-gradient(145deg, #1a1a1a, #0d0d0d);
            border: 1px solid var(--gold-mid); color: var(--gold-light);
            font-size: 30px; cursor: pointer; position: relative;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5), inset 0 0 10px rgba(191, 149, 63, 0.1);
            transition: 0.2s; overflow: hidden;
        }
        .gold-btn::before {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg); animation: shine 3s infinite;
        }
        .gold-btn:active { transform: scale(0.95); box-shadow: 0 0 15px var(--gold-mid); }
        .gold-btn::after {
            content: attr(data-label); position: absolute; bottom: 5px; left: 0; width: 100%;
            font-size: 9px; font-family: 'Cinzel', serif; letter-spacing: 1px; color: var(--gold-mid);
        }

        #mic-btn {
            width: 90px; height: 90px; border-radius: 50%; margin-top: -30px;
            border: 2px solid var(--gold-light);
            background: radial-gradient(circle, var(--gold-mid), var(--gold-dark));
            color: black; box-shadow: 0 0 30px rgba(191, 149, 63, 0.3);
        }
        #mic-btn.active { animation: pulse 1.5s infinite; background: #e74c3c; border-color: #ff7675; }

        /* MODALS */
        .modal {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.9); backdrop-filter: blur(15px);
            z-index: 100; display: none; align-items: center; justify-content: center;
            pointer-events: auto;
        }
        .luxury-card {
            background: #0a0a0a; width: 90%; max-width: 500px; border: 1px solid var(--gold-mid);
            border-radius: 4px; padding: 2px; /* Double border effect */
            box-shadow: 0 0 50px rgba(191, 149, 63, 0.2); position: relative;
        }
        .inner-card {
            border: 1px solid var(--gold-mid); padding: 30px; text-align: center;
        }
        h2 { font-family: 'Cinzel', serif; color: var(--gold-light); margin-top: 0; text-transform: uppercase; letter-spacing: 2px; }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .item-card {
            background: #111; border: 1px solid #333; padding: 15px; cursor: pointer; transition: 0.3s;
        }
        .item-card:hover { border-color: var(--gold-mid); background: #1a1a1a; }
        .item-card.owned { border-color: #27ae60; opacity: 0.5; }

        /* SPIN WHEEL */
        #wheel-ui { display: flex; flex-direction: column; align-items: center; }
        .wheel {
            width: 250px; height: 250px; border-radius: 50%; border: 5px solid var(--gold-mid);
            background: conic-gradient(#111 0deg 90deg, #222 90deg 180deg, #111 180deg 270deg, #222 270deg 360deg);
            position: relative; margin: 20px 0; transition: transform 3s cubic-bezier(0.25, 1, 0.5, 1);
        }
        .pointer {
            width: 0; height: 0; border-left: 10px solid transparent; border-right: 10px solid transparent;
            border-top: 20px solid var(--gold-light); position: absolute; top: -10px; left: 115px; z-index: 5;
        }

        /* GHOST */
        #ghost {
            position: fixed; font-size: 60px; pointer-events: none; z-index: 500;
            display: none; transform: translate(-50%, -50%); filter: drop-shadow(0 0 10px var(--gold-mid));
        }

        /* TOAST */
        .toast {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8); border: 1px solid var(--gold-mid); color: var(--gold-light);
            padding: 15px 40px; font-family: 'Cinzel', serif; letter-spacing: 1px;
            opacity: 0; pointer-events: none; transition: 0.4s;
        }

        @keyframes shine { 0% { transform: translateX(-100%) rotate(45deg); } 100% { transform: translateX(100%) rotate(45deg); } }
        @keyframes pulse { 0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); } 70% { transform: scale(1.05); box-shadow: 0 0 0 20px rgba(231, 76, 60, 0); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

<canvas id="cvs"></canvas>

<div id="ui-layer">
    <div class="header">
        <div class="profile">
            <div class="vip-badge" id="vip-lvl">V1</div>
            <div class="stats-col">
                <div class="currency-box">ü™ô <span id="gold-txt">0</span></div>
                <div class="currency-box">üíé <span id="gem-txt">0</span></div>
            </div>
        </div>
        <div class="bars">
            <div class="bar-pill"><div class="bar-fill" id="fill-food" style="background:#e74c3c"></div></div>
            <div class="bar-pill"><div class="bar-fill" id="fill-fun" style="background:#f1c40f"></div></div>
            <div class="bar-pill"><div class="bar-fill" id="fill-sleep" style="background:#3498db"></div></div>
        </div>
        <button class="gold-btn" style="width:50px; height:50px; font-size:20px;" onclick="UI.open('shop')">üëú</button>
    </div>

    <div class="dock">
        <button class="gold-btn" data-label="CAVIAR" onpointerdown="Input.start('food', event)">üç≤</button>
        <button class="gold-btn" data-label="SPA" onpointerdown="Input.start('sponge', event)">üõÅ</button>
        <button class="gold-btn" id="mic-btn" onpointerdown="AudioSys.rec()" onpointerup="AudioSys.stop()">üéôÔ∏è</button>
        <button class="gold-btn" data-label="CASINO" onclick="UI.open('casino')">üé∞</button>
        <button class="gold-btn" data-label="SKINS" onclick="UI.open('skins')">üé®</button>
    </div>
</div>

<!-- GHOST -->
<div id="ghost"></div>
<!-- TOAST -->
<div id="toast">VIP Level Up!</div>

<!-- SHOP MODAL -->
<div id="modal-shop" class="modal">
    <div class="luxury-card"><div class="inner-card">
        <div style="position:absolute; top:10px; right:20px; cursor:pointer;" onclick="UI.close()">‚úï</div>
        <h2>Luxury Market</h2>
        <div class="grid">
            <div class="item-card" onclick="Game.buy('hat', 500)">
                <div style="font-size:40px">üé©</div>
                <div>Top Hat</div><small>500 ü™ô</small>
            </div>
            <div class="item-card" onclick="Game.buy('monocle', 300)">
                <div style="font-size:40px">üßê</div>
                <div>Monocle</div><small>300 ü™ô</small>
            </div>
            <div class="item-card" onclick="Game.buy('chain', 1000)">
                <div style="font-size:40px">‚õìÔ∏è</div>
                <div>Gold Chain</div><small>1000 ü™ô</small>
            </div>
            <div class="item-card" onclick="Game.buy('energy', 50)">
                <div style="font-size:40px">‚òï</div>
                <div>Espresso</div><small>50 ü™ô</small>
            </div>
        </div>
    </div></div>
</div>

<!-- SKINS MODAL -->
<div id="modal-skins" class="modal">
    <div class="luxury-card"><div class="inner-card">
        <div style="position:absolute; top:10px; right:20px; cursor:pointer;" onclick="UI.close()">‚úï</div>
        <h2>Royal Skins</h2>
        <div class="grid">
            <div class="item-card" onclick="Game.setSkin('default')">
                <div style="width:40px; height:40px; background:#bdc3c7; border-radius:50%; margin:0 auto;"></div>
                <div>Standard</div>
            </div>
            <div class="item-card" onclick="Game.buySkin('gold', 2000)">
                <div style="width:40px; height:40px; background:linear-gradient(45deg, #f1c40f, #bf953f); border-radius:50%; margin:0 auto;"></div>
                <div>Solid Gold</div><small>2000 ü™ô</small>
            </div>
            <div class="item-card" onclick="Game.buySkin('diamond', 5000)">
                <div style="width:40px; height:40px; background:linear-gradient(45deg, #74b9ff, #fff); border-radius:50%; margin:0 auto;"></div>
                <div>Diamond</div><small>5000 ü™ô</small>
            </div>
            <div class="item-card" onclick="Game.buySkin('void', 10000)">
                <div style="width:40px; height:40px; background:black; border:1px solid white; border-radius:50%; margin:0 auto;"></div>
                <div>Void</div><small>10k ü™ô</small>
            </div>
        </div>
    </div></div>
</div>

<!-- CASINO MODAL -->
<div id="modal-casino" class="modal">
    <div class="luxury-card"><div class="inner-card">
        <div style="position:absolute; top:10px; right:20px; cursor:pointer;" onclick="UI.close()">‚úï</div>
        <h2>Fortune Wheel</h2>
        <div id="wheel-ui">
            <div class="pointer"></div>
            <div class="wheel" id="wheel">
                <div style="position:absolute; top:20px; left:110px; color:gold;">100</div>
                <div style="position:absolute; bottom:20px; left:110px; color:cyan;">üíé</div>
                <div style="position:absolute; top:110px; left:20px; color:gold;">500</div>
                <div style="position:absolute; top:110px; right:20px; color:red;">0</div>
            </div>
            <button class="gold-btn" style="width:200px; height:50px; font-size:20px; margin-top:20px;" onclick="Casino.spin()">SPIN (100ü™ô)</button>
        </div>
    </div></div>
</div>

<script>
    /** AUDIO (High Quality) **/
    const AudioSys = {
        ctx: new (window.AudioContext || window.webkitAudioContext)(),
        rec: null, chunks: [],
        init() { if(this.ctx.state==='suspended') this.ctx.resume(); },
        
        sfx(t) {
            this.init();
            const o = this.ctx.createOscillator(), g = this.ctx.createGain();
            o.connect(g); g.connect(this.ctx.destination);
            const n = this.ctx.currentTime;
            
            if(t==='coin') {
                o.type='sine'; o.frequency.setValueAtTime(1200,n); o.frequency.linearRampToValueAtTime(2000,n+0.2);
                g.gain.setValueAtTime(0.1,n); g.gain.linearRampToValueAtTime(0,n+0.4);
                o.start(); o.stop(n+0.4);
            } else if(t==='sparkle') {
                o.type='triangle'; o.frequency.setValueAtTime(800,n); o.frequency.linearRampToValueAtTime(1200,n+0.5);
                g.gain.setValueAtTime(0.05,n); g.gain.exponentialRampToValueAtTime(0.001,n+0.5);
                o.start(); o.stop(n+0.5);
            }
        },

        async rec() {
            try {
                this.init();
                const s = await navigator.mediaDevices.getUserMedia({audio:true});
                this.rec = new MediaRecorder(s);
                this.chunks=[];
                this.rec.ondataavailable=e=>this.chunks.push(e.data);
                this.rec.start();
                document.getElementById('mic-btn').classList.add('active');
                Game.dog.anim='listen';
            } catch(e) { UI.toast("Microphone Needed"); }
        },

        stop() {
            if(!this.rec || this.rec.state==='inactive') return;
            this.rec.stop();
            document.getElementById('mic-btn').classList.remove('active');
            this.rec.onstop = async () => {
                const b = new Blob(this.chunks,{type:'audio/ogg; codecs=opus'});
                const buf = await this.ctx.decodeAudioData(await b.arrayBuffer());
                const src = this.ctx.createBufferSource();
                src.buffer=buf; src.playbackRate.value=1.3;
                
                // Reverb effect (simple delay simulation)
                const delay = this.ctx.createDelay(); delay.delayTime.value = 0.1;
                const fb = this.ctx.createGain(); fb.gain.value = 0.2;
                src.connect(this.ctx.destination);
                src.connect(delay); delay.connect(fb); fb.connect(delay); delay.connect(this.ctx.destination);
                
                src.start();
                Game.dog.anim='talk';
                src.onended=()=>Game.dog.anim='idle';
            };
        }
    };

    /** GAME ENGINE **/
    const cvs = document.getElementById('cvs');
    const ctx = cvs.getContext('2d');
    let W, H;

    const Game = {
        gold: 1000,
        gems: 5,
        vip: 1,
        needs: { food:80, fun:80, sleep:90 },
        inv: { hat:false, monocle:false, chain:false },
        skins: { gold:false, diamond:false, void:false },
        
        currentSkin: 'default',
        time: 0,
        
        dog: {
            x:0, y:0, scaleY:1,
            anim: 'idle',
            blink: 0
        },
        
        particles: [],

        init() {
            this.resize();
            window.addEventListener('resize', ()=>this.resize());
            this.load();
            this.loop();
            setInterval(()=>this.logic(), 1000);
            setInterval(()=>this.save(), 5000);
        },

        resize() {
            W=window.innerWidth; H=window.innerHeight;
            cvs.width=W; cvs.height=H;
            this.dog.x=W/2; this.dog.y=H/2+100;
        },

        logic() {
            this.time += 0.005;
            this.needs.food = Math.max(0, this.needs.food-0.5);
            this.needs.fun = Math.max(0, this.needs.fun-0.5);
            this.needs.sleep = Math.max(0, this.needs.sleep-0.2);
            UI.update();
        },

        save() {
            localStorage.setItem('royalDog', JSON.stringify({
                gold: this.gold, gems: this.gems, vip: this.vip,
                needs: this.needs, inv: this.inv, skins: this.skins, currentSkin: this.currentSkin
            }));
        },

        load() {
            const d = JSON.parse(localStorage.getItem('royalDog'));
            if(d) {
                this.gold=d.gold; this.gems=d.gems; this.vip=d.vip;
                this.needs=d.needs; this.inv=d.inv; this.skins=d.skins; this.currentSkin=d.currentSkin;
            }
        },

        buy(item, price) {
            if(item==='energy') {
                if(this.gold>=price) { this.gold-=price; this.needs.sleep=100; UI.toast("Recharged!"); }
                return;
            }
            if(this.gold >= price && !this.inv[item]) {
                this.gold-=price; this.inv[item]=true; UI.toast("Purchased Luxury Item");
                UI.update();
            } else UI.toast("Cannot Purchase");
        },

        buySkin(skin, price) {
            if(this.gold >= price && !this.skins[skin]) {
                this.gold-=price; this.skins[skin]=true; 
                this.currentSkin = skin;
                UI.toast(skin.toUpperCase() + " Acquired!");
                AudioSys.sfx('sparkle');
                UI.update();
            } else if(this.skins[skin]) {
                this.setSkin(skin);
            } else {
                UI.toast("Need more Gold");
            }
        },

        setSkin(s) { this.currentSkin=s; UI.toast("Skin Applied"); },

        loop() {
            ctx.clearRect(0,0,W,H);
            this.drawCity();
            this.drawDog();
            this.drawParticles();
            requestAnimationFrame(()=>this.loop());
        },

        drawCity() {
            // Gradient Sky (Day/Night cycle based on time)
            const t = (Math.sin(this.time)+1)/2; // 0 to 1
            const top = this.lerpColor('#000000', '#2c3e50', t);
            const bot = this.lerpColor('#2c3e50', '#8e44ad', t);
            
            const g = ctx.createLinearGradient(0,0,0,H);
            g.addColorStop(0, top); g.addColorStop(1, bot);
            ctx.fillStyle=g; ctx.fillRect(0,0,W,H);

            // Stars
            ctx.fillStyle = 'white';
            for(let i=0; i<20; i++) {
                const x = (i*137)%W; const y = (i*53)%H/2;
                const s = Math.sin(this.time*5 + i);
                if(s>0) { ctx.globalAlpha=s; ctx.beginPath(); ctx.arc(x,y,1,0,Math.PI*2); ctx.fill(); }
            }
            ctx.globalAlpha=1;

            // City Skyline
            ctx.fillStyle='#050505';
            ctx.beginPath();
            ctx.moveTo(0,H);
            for(let i=0; i<=W; i+=50) {
                const h = 100 + Math.abs(Math.sin(i*13))*150;
                ctx.lineTo(i, H-h); ctx.lineTo(i+40, H-h);
            }
            ctx.lineTo(W,H);
            ctx.fill();

            // Windows
            ctx.fillStyle='#f1c40f';
            for(let i=0; i<20; i++) {
                if(Math.random()>0.95) ctx.fillRect(Math.random()*W, H-Math.random()*200, 3, 3);
            }

            // Penthouse Floor reflection
            const fg = ctx.createLinearGradient(0,H-200,0,H);
            fg.addColorStop(0, 'rgba(0,0,0,0.5)'); fg.addColorStop(1, '#000');
            ctx.fillStyle=fg; ctx.fillRect(0,H-200,W,200);
        },
        
        // Helper
        lerpColor(a, b, amount) { 
            return a; // Simplified for single file, actual lerp is complex
        },

        drawDog() {
            const d = this.dog;
            const b = Math.sin(Date.now()/900)*4;
            let sy = d.scaleY + (b*0.003);
            
            ctx.save();
            ctx.translate(d.x, d.y);
            ctx.scale(1, sy);

            // Shadow
            ctx.fillStyle='rgba(0,0,0,0.5)';
            ctx.beginPath(); ctx.ellipse(0, 95, 80, 20, 0,0,Math.PI*2); ctx.fill();

            // Colors based on skin
            let baseC='#bdc3c7', shadC='#7f8c8d', highlight='white';
            if(this.currentSkin==='gold') { baseC='#f1c40f'; shadC='#b7950b'; highlight='#fff'; }
            if(this.currentSkin==='diamond') { baseC='#74b9ff'; shadC='#0984e3'; highlight='#fff'; }
            if(this.currentSkin==='void') { baseC='#000'; shadC='#111'; highlight='#333'; }

            // Shine Effect (Gold/Diamond)
            if(this.currentSkin==='gold' || this.currentSkin==='diamond') {
                ctx.shadowBlur = 20; ctx.shadowColor = baseC;
            }

            // Tail
            if(d.anim!=='sleep') {
                const wag = Math.sin(Date.now()/100)*15;
                ctx.strokeStyle=shadC; ctx.lineWidth=18; ctx.lineCap='round';
                ctx.beginPath(); ctx.moveTo(40,60); ctx.quadraticCurveTo(70,50,80,10+wag); ctx.stroke();
            }

            // Body
            const bg = ctx.createRadialGradient(-20,-20,10,0,0,80);
            bg.addColorStop(0, baseC); bg.addColorStop(1, shadC);
            ctx.fillStyle=bg;
            
            ctx.beginPath(); ctx.moveTo(-45,80); ctx.quadraticCurveTo(-70,80,-60,-20);
            ctx.lineTo(60,-20); ctx.quadraticCurveTo(70,80,45,80); ctx.fill();

            // Belly
            ctx.fillStyle=highlight; ctx.globalAlpha=0.3;
            ctx.beginPath(); ctx.ellipse(0,40,30,45,0,0,Math.PI*2); ctx.fill();
            ctx.globalAlpha=1;

            // Head
            ctx.translate(0, -60+b);
            // Ears
            ctx.fillStyle=shadC;
            ctx.beginPath(); ctx.ellipse(-50,0,20,50,0.2,0,Math.PI*2); ctx.fill();
            ctx.beginPath(); ctx.ellipse(50,0,20,50,-0.2,0,Math.PI*2); ctx.fill();

            // Head Shape
            const hg = ctx.createRadialGradient(0,0,10,0,0,70);
            hg.addColorStop(0, baseC); hg.addColorStop(1, shadC);
            ctx.fillStyle=hg; ctx.beginPath(); ctx.arc(0,0,70,0,Math.PI*2); ctx.fill();

            // Face
            const eyeC = this.currentSkin==='void'?'red':'#000';
            
            // Eyes
            const lx = (Input.x - W/2)/30; const ly = (Input.y - H/2)/30;
            ctx.fillStyle='white';
            ctx.beginPath(); ctx.ellipse(-25,-5,15,20,0,0,Math.PI*2); ctx.fill();
            ctx.beginPath(); ctx.ellipse(25,-5,15,20,0,0,Math.PI*2); ctx.fill();
            
            ctx.fillStyle=eyeC;
            const px = Math.min(5,Math.max(-5,lx));
            const py = Math.min(5,Math.max(-5,ly));
            ctx.beginPath(); ctx.arc(-25+px, -5+py, 8, 0, Math.PI*2); ctx.fill();
            ctx.beginPath(); ctx.arc(25+px, -5+py, 8, 0, Math.PI*2); ctx.fill();

            // Snout
            ctx.fillStyle=highlight; ctx.globalAlpha=0.8;
            ctx.beginPath(); ctx.ellipse(0,20,30,22,0,0,Math.PI*2); ctx.fill();
            ctx.globalAlpha=1;
            ctx.fillStyle=eyeC;
            ctx.beginPath(); ctx.ellipse(0,15,14,9,0,0,Math.PI*2); ctx.fill();

            // Mouth
            if(d.anim==='talk') {
                ctx.fillStyle='#e74c3c';
                const o = 10+Math.abs(Math.sin(Date.now()/50)*15);
                ctx.beginPath(); ctx.arc(0,35,o,0,Math.PI); ctx.fill();
            } else {
                ctx.strokeStyle=eyeC; ctx.lineWidth=3;
                ctx.beginPath(); ctx.moveTo(-10,35); ctx.quadraticCurveTo(0,42,10,35); ctx.stroke();
            }

            // Accessories
            ctx.shadowBlur=0;
            if(this.inv.monocle) {
                ctx.strokeStyle='gold'; ctx.lineWidth=3; ctx.fillStyle='rgba(255,255,255,0.3)';
                ctx.beginPath(); ctx.arc(-25,-5,22,0,Math.PI*2); ctx.fill(); ctx.stroke();
                ctx.beginPath(); ctx.moveTo(-47,-5); ctx.lineTo(-47, 50); ctx.stroke();
            }
            if(this.inv.hat) {
                ctx.fillStyle='#111';
                ctx.beginPath(); ctx.rect(-50,-70,100,60); ctx.fill();
                ctx.beginPath(); ctx.rect(-70,-10,140,10); ctx.fill();
                ctx.fillStyle='red'; ctx.fillRect(-50,-20,100,10);
            }
            if(this.inv.chain) {
                ctx.translate(0,60);
                ctx.strokeStyle='gold'; ctx.lineWidth=5;
                ctx.beginPath(); ctx.arc(0,0,50,0,Math.PI); ctx.stroke();
                ctx.fillStyle='gold'; ctx.font='20px Arial'; ctx.fillText('$', -5, 50);
            }

            ctx.restore();
        },

        drawParticles() {
            // Gold sparkles for VIPs
            if(Math.random()<0.1) {
                this.particles.push({x:Math.random()*W, y:Math.random()*H, vx:0, vy:Math.random(), t:'‚ú®', life:1});
            }

            for(let i=this.particles.length-1; i>=0; i--) {
                let p = this.particles[i];
                p.x+=p.vx; p.y+=p.vy; p.life-=0.02;
                ctx.globalAlpha = p.life;
                if(p.t==='‚ú®') {
                    ctx.fillStyle='gold'; ctx.font='10px Arial'; ctx.fillText('‚ú¶',p.x,p.y);
                } else if(p.t==='bubble') {
                     ctx.strokeStyle='white'; ctx.beginPath(); ctx.arc(p.x,p.y,5,0,Math.PI*2); ctx.stroke();
                } else {
                    ctx.font='30px Arial'; ctx.fillText(p.t,p.x,p.y);
                }
                ctx.globalAlpha=1;
                if(p.life<=0) this.particles.splice(i,1);
            }
        }
    };

    /** CASINO **/
    const Casino = {
        spinning: false,
        rotation: 0,
        
        spin() {
            if(this.spinning || Game.gold < 100) return UI.toast("Need 100 Gold");
            Game.gold -= 100;
            UI.update();
            
            this.spinning = true;
            const wheel = document.getElementById('wheel');
            const spins = 5 + Math.random()*5;
            const deg = spins * 360;
            this.rotation += deg;
            
            wheel.style.transform = `rotate(${this.rotation}deg)`;
            
            setTimeout(() => {
                this.spinning = false;
                // Calculate Reward based on rotation (Mock logic for effect)
                const r = Math.random();
                if(r > 0.9) { Game.gems += 5; UI.toast("JACKPOT! 5 Gems!"); AudioSys.sfx('coin'); }
                else if (r > 0.5) { Game.gold += 500; UI.toast("Won 500 Gold!"); AudioSys.sfx('coin'); }
                else { UI.toast("No Luck..."); }
                UI.update();
            }, 3000);
        }
    };

    /** INPUT **/
    const Input = {
        x:0, y:0, drag:null,
        start(t, e) {
            e.preventDefault();
            this.drag=t;
            const g = document.getElementById('ghost');
            g.innerText = t==='food'?'üç±':'üßº';
            g.style.display='block';
            this.move(e);
        },
        move(e) {
            const cx = e.touches?e.touches[0].clientX:e.clientX;
            const cy = e.touches?e.touches[0].clientY:e.clientY;
            this.x=cx; this.y=cy;
            if(this.drag) {
                const g=document.getElementById('ghost');
                g.style.left=cx+'px'; g.style.top=cy+'px';
            }
        },
        end() {
            if(!this.drag) return;
            if(Math.hypot(this.x-Game.dog.x, this.y-(Game.dog.y-50)) < 100) {
                if(this.drag==='food') {
                    Game.needs.food = Math.min(100, Game.needs.food+20);
                    Game.dog.scaleY = 0.8; AudioSys.sfx('coin');
                    Game.particles.push({x:Game.dog.x, y:Game.dog.y-50, t:'üòã', vx:0, vy:-2, life:1});
                }
                if(this.drag==='sponge') {
                    Game.needs.fun = Math.min(100, Game.needs.fun+0.5);
                    if(Math.random()<0.2) {
                        Game.particles.push({x:this.x, y:this.y, t:'bubble', vx:Math.random()-0.5, vy:-2, life:1});
                        AudioSys.sfx('sparkle');
                    }
                }
            }
            this.drag=null;
            document.getElementById('ghost').style.display='none';
        }
    };
    window.addEventListener('pointermove',e=>Input.move(e));
    window.addEventListener('pointerup',e=>Input.end());

    const UI = {
        update() {
            document.getElementById('gold-txt').innerText = Game.gold;
            document.getElementById('gem-txt').innerText = Game.gems;
            document.getElementById('vip-lvl').innerText = "V"+Game.vip;
            document.getElementById('fill-food').style.transform = `scaleY(${Game.needs.food/100})`;
            document.getElementById('fill-fun').style.transform = `scaleY(${Game.needs.fun/100})`;
            document.getElementById('fill-sleep').style.transform = `scaleY(${Game.needs.sleep/100})`;
        },
        open(id) { document.getElementById('modal-'+id).style.display='flex'; },
        close() { 
            document.querySelectorAll('.modal').forEach(m=>m.style.display='none'); 
        },
        toast(m) {
            const t=document.getElementById('toast');
            t.innerText=m; t.style.opacity=1;
            setTimeout(()=>t.style.opacity=0, 2000);
        }
    };

    Game.init();

</script>
</body>
</html>
