<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Elite Premium Golden Dog (Auto-Save)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Montserrat:wght@300;600&display=swap');

        :root {
            --gold: #FFD700;
            --gold-dark: #B8860B;
            --gold-grad: linear-gradient(135deg, #FFF8DC, #FFD700, #B8860B, #8B4513);
            --black: #050505;
            --glass: rgba(20, 20, 20, 0.85);
            --neon-blue: #00f3ff;
        }

        body {
            margin: 0; overflow: hidden; background: var(--black);
            font-family: 'Montserrat', sans-serif; color: white;
            touch-action: none; user-select: none;
        }

        canvas { display: block; width: 100%; height: 100%; }

        /* --- UI LAYER --- */
        #ui {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; display: flex; flex-direction: column;
            justify-content: space-between; z-index: 10;
        }

        /* HEADER */
        .header {
            padding: 20px; display: flex; justify-content: space-between; align-items: flex-start;
            pointer-events: auto; background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent);
        }

        .rank-badge {
            width: 60px; height: 60px; border-radius: 50%;
            background: var(--gold-grad); border: 2px solid white;
            display: flex; align-items: center; justify-content: center;
            font-family: 'Cinzel', serif; font-weight: 900; color: black; font-size: 24px;
            box-shadow: 0 0 20px var(--gold);
        }

        .wealth-display {
            text-align: right; text-shadow: 0 0 10px rgba(0,0,0,0.8);
        }
        .net-worth { font-size: 28px; font-weight: 700; color: var(--gold); font-family: 'Cinzel', serif; }
        .income { font-size: 14px; color: #2ecc71; font-weight: 600; }

        /* STATUS BARS */
        .bars {
            position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 5px;
        }
        .bar-col { width: 10px; height: 40px; background: rgba(255,255,255,0.1); border: 1px solid #444; border-radius: 20px; overflow: hidden; }
        .bar-fill { width: 100%; height: 100%; background: white; transform-origin: bottom; transition: transform 0.5s; }

        /* DOCK */
        .dock {
            padding: 30px; display: flex; justify-content: center; gap: 20px;
            background: linear-gradient(to top, #000, transparent); pointer-events: auto;
        }

        .lux-btn {
            width: 75px; height: 75px; border-radius: 20px;
            background: rgba(10,10,10,0.9); border: 1px solid var(--gold);
            color: var(--gold); font-size: 32px; cursor: pointer;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); position: relative;
            transition: 0.2s; overflow: hidden;
        }
        .lux-btn:active { transform: scale(0.95); background: var(--gold); color: black; }
        .lux-btn::after {
            content: attr(data-label); position: absolute; bottom: 5px; left:0; width:100%;
            font-size: 9px; font-weight: 700; letter-spacing: 1px;
        }

        #mic-btn {
            width: 90px; height: 90px; border-radius: 50%; margin-top: -20px;
            background: var(--gold-grad); color: black; border: 3px solid white;
            box-shadow: 0 0 30px var(--gold-dark); animation: shine 3s infinite linear;
        }
        #mic-btn.active { animation: pulse 0.5s infinite; background: #ff4757; }

        /* MODALS */
        .modal {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.92); backdrop-filter: blur(10px);
            z-index: 100; display: none; align-items: center; justify-content: center;
            pointer-events: auto;
        }
        .modal-content {
            background: #0a0a0a; width: 90%; max-width: 600px;
            border: 1px solid var(--gold); padding: 2px;
            box-shadow: 0 0 60px rgba(184, 134, 11, 0.3);
        }
        .inner-box {
            border: 1px solid var(--gold-dark); padding: 30px;
            display: flex; flex-direction: column; gap: 20px;
        }
        h2 { margin: 0; font-family: 'Cinzel', serif; color: var(--gold); text-align: center; font-size: 30px; }

        .graph-container {
            width: 100%; height: 150px; background: #111; border: 1px solid #333;
            position: relative; overflow: hidden; display: flex; align-items: flex-end; gap: 2px;
        }
        .graph-bar { width: 5%; background: #2ecc71; transition: height 0.2s; opacity: 0.8; }

        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .card {
            background: #151515; padding: 15px; border: 1px solid #333; cursor: pointer; transition: 0.3s;
            display: flex; justify-content: space-between; align-items: center;
        }
        .card:hover { border-color: var(--gold); background: #222; }
        .card.owned-item { border-color: #2ecc71; opacity: 0.6; pointer-events: none; }
        .card h4 { margin: 0; color: white; }
        .card small { color: #888; }
        .price { color: var(--gold); font-weight: bold; }

        #ghost {
            position: fixed; font-size: 60px; pointer-events: none; z-index: 500;
            display: none; transform: translate(-50%, -50%); filter: drop-shadow(0 0 15px var(--gold));
        }

        .toast {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: var(--gold-grad); color: black; padding: 20px 40px;
            font-family: 'Cinzel', serif; font-weight: 900; font-size: 20px;
            opacity: 0; pointer-events: none; transition: 0.4s; z-index: 200;
            box-shadow: 0 0 30px var(--gold);
        }

        .reset-btn {
            background: #c0392b; color: white; border: none; padding: 10px; cursor: pointer; width: 100%; margin-top:10px;
        }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

<canvas id="cvs"></canvas>

<div id="ui">
    <div class="header">
        <div style="display:flex; gap:15px; align-items:center;">
            <div class="rank-badge" id="rank-txt">1</div>
            <div>
                <div style="color:#888; font-size:12px; letter-spacing:2px;">ELITE STATUS</div>
                <div style="color:white; font-weight:bold;" id="title-txt">Novice</div>
            </div>
        </div>
        
        <div class="bars">
            <div class="bar-col"><div class="bar-fill" id="fill-food"></div></div>
            <div class="bar-col"><div class="bar-fill" id="fill-clean"></div></div>
            <div class="bar-col"><div class="bar-fill" id="fill-energy"></div></div>
        </div>

        <div class="wealth-display">
            <div class="net-worth">$<span id="cash-txt">0</span></div>
            <div class="income">+<span id="income-txt">0</span>/sec</div>
            <div style="font-size:10px; color:#888;">(Auto Saved)</div>
        </div>
    </div>

    <div class="dock">
        <button class="lux-btn" data-label="STOCKS" onclick="UI.open('stocks')">üìà</button>
        <button class="lux-btn" data-label="REAL ESTATE" onclick="UI.open('travel')">‚úàÔ∏è</button>
        <button class="lux-btn" id="mic-btn" onpointerdown="AudioSys.rec()" onpointerup="AudioSys.stop()">üéôÔ∏è</button>
        <button class="lux-btn" data-label="LUXURY" onclick="UI.open('shop')">üëú</button>
        <button class="lux-btn" data-label="FEED" onpointerdown="Input.start('caviar', event)">üç±</button>
    </div>
</div>

<div id="ghost"></div>
<div id="toast">SAVED</div>

<!-- STOCKS MODAL -->
<div id="modal-stocks" class="modal">
    <div class="modal-content"><div class="inner-box">
        <div style="display:flex; justify-content:space-between;">
            <h2>Wall Street</h2>
            <button class="lux-btn" style="width:40px; height:40px; font-size:16px;" onclick="UI.close()">‚úï</button>
        </div>
        <div class="graph-container" id="stock-graph"></div>
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <div>
                <div style="color:#888;">DOGE COIN</div>
                <div style="font-size:24px; color:white;">$<span id="stock-price">0</span></div>
            </div>
            <div style="color:#2ecc71;" id="stock-change">+0%</div>
        </div>
        <div class="grid">
            <button class="lux-btn" style="width:100%" onclick="StockMarket.buy()">BUY</button>
            <button class="lux-btn" style="width:100%" onclick="StockMarket.sell()">SELL</button>
        </div>
        <div style="text-align:center; color:#888;">Owned: <span id="stock-owned">0</span> Shares</div>
    </div></div>
</div>

<!-- REAL ESTATE MODAL -->
<div id="modal-travel" class="modal">
    <div class="modal-content"><div class="inner-box">
        <div style="display:flex; justify-content:space-between;">
            <h2>Real Estate</h2>
            <button class="lux-btn" style="width:40px; height:40px; font-size:16px;" onclick="UI.close()">‚úï</button>
        </div>
        <div class="grid" id="estate-grid">
            <!-- Populated by JS -->
        </div>
    </div></div>
</div>

<!-- SHOP MODAL -->
<div id="modal-shop" class="modal">
    <div class="modal-content"><div class="inner-box">
        <div style="display:flex; justify-content:space-between;">
            <h2>Elite Boutique</h2>
            <button class="lux-btn" style="width:40px; height:40px; font-size:16px;" onclick="UI.close()">‚úï</button>
        </div>
        <div class="grid" id="shop-grid">
            <!-- Populated by JS -->
        </div>
        <button class="reset-btn" onclick="SaveSys.reset()">‚ö†Ô∏è RESET ALL PROGRESS</button>
    </div></div>
</div>

<script>
    /** AUDIO SYSTEM **/
    const AudioSys = {
        ctx: new (window.AudioContext || window.webkitAudioContext)(),
        rec: null, chunks: [],
        init() { if(this.ctx.state==='suspended') this.ctx.resume(); },
        sfx(t) {
            this.init();
            const o=this.ctx.createOscillator(), g=this.ctx.createGain();
            o.connect(g); g.connect(this.ctx.destination);
            const n=this.ctx.currentTime;
            
            if(t==='cash') {
                o.type='sine'; o.frequency.setValueAtTime(1200,n); o.frequency.linearRampToValueAtTime(2000,n+0.2);
                g.gain.setValueAtTime(0.1,n); g.gain.linearRampToValueAtTime(0,n+0.4);
                o.start(); o.stop(n+0.4);
            } else if(t==='sparkle') {
                o.type='triangle'; o.frequency.setValueAtTime(600,n); o.frequency.linearRampToValueAtTime(1200,n+0.5);
                g.gain.setValueAtTime(0.05,n); g.gain.exponentialRampToValueAtTime(0.001,n+0.5);
                o.start(); o.stop(n+0.5);
            }
        },
        async rec() {
            try {
                this.init();
                const s = await navigator.mediaDevices.getUserMedia({audio:true});
                this.rec = new MediaRecorder(s);
                this.chunks=[];
                this.rec.ondataavailable=e=>this.chunks.push(e.data);
                this.rec.start();
                document.getElementById('mic-btn').classList.add('active');
                Game.dog.anim='listen';
            } catch(e) {}
        },
        stop() {
            if(!this.rec || this.rec.state==='inactive') return;
            this.rec.stop();
            document.getElementById('mic-btn').classList.remove('active');
            this.rec.onstop = async () => {
                const b = new Blob(this.chunks,{type:'audio/ogg; codecs=opus'});
                const buf = await this.ctx.decodeAudioData(await b.arrayBuffer());
                const src = this.ctx.createBufferSource();
                src.buffer=buf; src.playbackRate.value=1.3;
                src.connect(this.ctx.destination);
                src.start();
                Game.dog.anim='talk';
                src.onended=()=>Game.dog.anim='idle';
            };
        }
    };

    /** SAVE SYSTEM (LocalStorage) **/
    const SaveSys = {
        key: 'eliteGoldenDogData_v2',
        save() {
            const data = {
                cash: Game.cash,
                income: Game.income,
                location: Game.location,
                skin: Game.skin,
                unlockedLocs: Game.unlockedLocs,
                unlockedSkins: Game.unlockedSkins,
                ownedAssets: Game.ownedAssets,
                stockOwned: StockMarket.owned,
                needs: Game.needs
            };
            localStorage.setItem(this.key, JSON.stringify(data));
        },
        load() {
            const saved = localStorage.getItem(this.key);
            if(saved) {
                const d = JSON.parse(saved);
                Game.cash = d.cash || 5000;
                Game.income = d.income || 0;
                Game.location = d.location || 'penthouse';
                Game.skin = d.skin || 'default';
                Game.unlockedLocs = d.unlockedLocs || ['penthouse'];
                Game.unlockedSkins = d.unlockedSkins || ['default'];
                Game.ownedAssets = d.ownedAssets || {};
                StockMarket.owned = d.stockOwned || 0;
                Game.needs = d.needs || {food:80,clean:80,energy:90};
            }
        },
        reset() {
            if(confirm("Are you sure you want to reset all progress? This cannot be undone.")) {
                localStorage.removeItem(this.key);
                location.reload();
            }
        }
    };

    /** STOCK MARKET ENGINE **/
    const StockMarket = {
        price: 100,
        history: [],
        owned: 0,
        
        update() {
            const change = (Math.random()-0.48) * 10;
            this.price = Math.max(10, this.price + change);
            this.history.push(this.price);
            if(this.history.length > 20) this.history.shift();
            
            if(document.getElementById('modal-stocks').style.display === 'flex') {
                this.drawGraph();
                document.getElementById('stock-price').innerText = this.price.toFixed(2);
                document.getElementById('stock-owned').innerText = this.owned;
                const el = document.getElementById('stock-change');
                el.innerText = (change>0?'+':'') + change.toFixed(2);
                el.style.color = change>0?'#2ecc71':'#e74c3c';
            }
        },
        drawGraph() {
            const c = document.getElementById('stock-graph');
            c.innerHTML = '';
            this.history.forEach(h => {
                const d = document.createElement('div');
                d.className = 'graph-bar';
                d.style.height = (h/2) + 'px';
                d.style.background = '#f1c40f';
                c.appendChild(d);
            });
        },
        buy() {
            if(Game.cash >= this.price) {
                Game.cash -= this.price;
                this.owned++;
                AudioSys.sfx('cash');
                UI.update();
                SaveSys.save(); // Save Immediately
                this.update();
            } else UI.toast("Insufficient Funds");
        },
        sell() {
            if(this.owned > 0) {
                Game.cash += this.price;
                this.owned--;
                AudioSys.sfx('cash');
                UI.update();
                SaveSys.save(); // Save Immediately
                this.update();
            }
        }
    };

    /** GAME ENGINE **/
    const cvs = document.getElementById('cvs');
    const ctx = cvs.getContext('2d');
    let W, H;

    const Game = {
        cash: 5000,
        income: 0,
        location: 'penthouse',
        skin: 'default',
        unlockedLocs: ['penthouse'],
        unlockedSkins: ['default'],
        ownedAssets: {},
        
        needs: { food:80, clean:80, energy:90 },
        
        dog: { x:0, y:0, scaleY:1, anim:'idle', blink:0 },
        particles: [],

        init() {
            this.resize();
            window.addEventListener('resize', ()=>this.resize());
            SaveSys.load(); // LOAD DATA
            this.loop();
            setInterval(()=>this.logic(), 1000);
            setInterval(()=>StockMarket.update(), 2000);
            setInterval(()=>SaveSys.save(), 10000); // Auto save every 10s
        },

        resize() {
            W=window.innerWidth; H=window.innerHeight;
            cvs.width=W; cvs.height=H;
            this.dog.x=W/2; this.dog.y=H/2+80;
        },

        logic() {
            this.cash += this.income;
            this.needs.food = Math.max(0, this.needs.food-1);
            this.needs.clean = Math.max(0, this.needs.clean-0.5);
            this.needs.energy = Math.max(0, this.needs.energy-0.5);
            
            let rank = 1;
            if(this.cash > 100000) rank=2;
            if(this.cash > 1000000) rank=3;
            document.getElementById('rank-txt').innerText = rank;
            document.getElementById('title-txt').innerText = rank===1?'Tycoon':(rank===2?'Baron':'Emperor');
            
            UI.update();
        },

        travel(loc, cost) {
            if(this.unlockedLocs.includes(loc)) {
                this.location = loc;
                UI.toast("Welcome to " + loc.toUpperCase());
                UI.close();
                SaveSys.save();
            } else if (this.cash >= cost) {
                this.cash -= cost;
                this.unlockedLocs.push(loc);
                this.location = loc;
                UI.toast("Property Acquired!");
                AudioSys.sfx('cash');
                UI.close();
                SaveSys.save();
            } else {
                UI.toast("Insufficient Funds");
            }
        },

        buyAsset(type, cost, inc) {
            if(this.ownedAssets[type]) return; // One time purchase for simplicity in this demo, or stack logic
            
            if(this.cash >= cost) {
                this.cash -= cost;
                this.income += inc;
                this.ownedAssets[type] = true;
                UI.toast("Asset Acquired");
                AudioSys.sfx('cash');
                UI.update();
                UI.renderShop(); // Update shop UI state
                SaveSys.save();
            } else UI.toast("Insufficient Funds");
        },

        buySkin(skin, cost) {
            if(this.unlockedSkins.includes(skin)) {
                this.skin = skin; UI.toast("Skin Applied"); UI.close();
                SaveSys.save();
            } else if (this.cash >= cost) {
                this.cash -= cost;
                this.unlockedSkins.push(skin);
                this.skin = skin;
                UI.toast("Luxury Skin Acquired");
                AudioSys.sfx('sparkle');
                UI.close();
                SaveSys.save();
            } else {
                UI.toast("Too Expensive");
            }
        },

        loop() {
            ctx.clearRect(0,0,W,H);
            this.drawBackground();
            this.drawDog();
            this.drawParticles();
            requestAnimationFrame(()=>this.loop());
        },

        drawBackground() {
            let top='#000', bot='#111';
            
            if(this.location==='penthouse') { top='#1a0b2e'; bot='#000'; }
            if(this.location==='yacht') { top='#050510'; bot='#001f3f'; }
            if(this.location==='moon') { top='#000'; bot='#111'; }
            if(this.location==='gold_room') { top='#332200'; bot='#664400'; }

            const g = ctx.createLinearGradient(0,0,0,H);
            g.addColorStop(0, top); g.addColorStop(1, bot);
            ctx.fillStyle=g; ctx.fillRect(0,0,W,H);

            if(this.location==='penthouse') {
                ctx.fillStyle = '#f1c40f';
                for(let i=0; i<30; i++) {
                    if(Math.random()>0.9) ctx.fillRect(Math.random()*W, H-Math.random()*300, 2, 2);
                }
            }
        },

        drawDog() {
            const d = this.dog;
            const b = Math.sin(Date.now()/900)*4;
            let sy = d.scaleY + (b*0.003);
            
            ctx.save();
            ctx.translate(d.x, d.y);
            ctx.scale(1, sy);

            let mainC='#bdc3c7', shadC='#7f8c8d', shine='rgba(255,255,255,0.1)';
            if(this.skin==='gold') { mainC='#f1c40f'; shadC='#b7950b'; shine='rgba(255,255,255,0.4)'; }
            if(this.skin==='diamond') { mainC='#00f3ff'; shadC='#0097e6'; shine='rgba(255,255,255,0.6)'; }

            if(this.skin==='diamond') { ctx.shadowBlur=20; ctx.shadowColor='#00f3ff'; }

            ctx.fillStyle='rgba(0,0,0,0.5)'; ctx.shadowBlur=0;
            ctx.beginPath(); ctx.ellipse(0, 95, 80, 20, 0,0,Math.PI*2); ctx.fill();

            if(d.anim!=='sleep') {
                const wag = Math.sin(Date.now()/100)*15;
                ctx.strokeStyle=shadC; ctx.lineWidth=18; ctx.lineCap='round';
                ctx.beginPath(); ctx.moveTo(40,60); ctx.quadraticCurveTo(70,50,80,10+wag); ctx.stroke();
            }

            const bodyG = ctx.createRadialGradient(-20,-20,10,0,0,80);
            bodyG.addColorStop(0, mainC); bodyG.addColorStop(1, shadC);
            ctx.fillStyle=bodyG;
            ctx.beginPath(); ctx.moveTo(-45,80); ctx.quadraticCurveTo(-70,80,-60,-20);
            ctx.lineTo(60,-20); ctx.quadraticCurveTo(70,80,45,80); ctx.fill();

            ctx.fillStyle=shine; ctx.globalAlpha=0.3;
            ctx.beginPath(); ctx.ellipse(0,40,30,45,0,0,Math.PI*2); ctx.fill();
            ctx.globalAlpha=1;

            ctx.translate(0, -60+b);
            ctx.fillStyle=shadC;
            ctx.beginPath(); ctx.ellipse(-50,0,20,50,0.2,0,Math.PI*2); ctx.fill();
            ctx.beginPath(); ctx.ellipse(50,0,20,50,-0.2,0,Math.PI*2); ctx.fill();

            const headG = ctx.createRadialGradient(0,0,10,0,0,70);
            headG.addColorStop(0, mainC); headG.addColorStop(1, shadC);
            ctx.fillStyle=headG; ctx.beginPath(); ctx.arc(0,0,70,0,Math.PI*2); ctx.fill();

            ctx.fillStyle=shine;
            ctx.beginPath(); ctx.ellipse(-20, -30, 10, 20, -0.5, 0, Math.PI*2); ctx.fill();

            const lx = (Input.x-W/2)/30; const ly = (Input.y-H/2)/30;
            ctx.fillStyle='white';
            ctx.beginPath(); ctx.ellipse(-25,-5,15,20,0,0,Math.PI*2); ctx.fill();
            ctx.beginPath(); ctx.ellipse(25,-5,15,20,0,0,Math.PI*2); ctx.fill();
            
            ctx.fillStyle='#000';
            const px=Math.min(5,Math.max(-5,lx)); const py=Math.min(5,Math.max(-5,ly));
            ctx.beginPath(); ctx.arc(-25+px,-5+py,8,0,Math.PI*2); ctx.fill();
            ctx.beginPath(); ctx.arc(25+px,-5+py,8,0,Math.PI*2); ctx.fill();

            ctx.fillStyle='white'; ctx.globalAlpha=0.7;
            ctx.beginPath(); ctx.ellipse(0,20,30,22,0,0,Math.PI*2); ctx.fill();
            ctx.globalAlpha=1;
            ctx.fillStyle='#000'; ctx.beginPath(); ctx.ellipse(0,15,14,9,0,0,Math.PI*2); ctx.fill();

            if(d.anim==='talk') {
                ctx.fillStyle='#e74c3c';
                const o=10+Math.abs(Math.sin(Date.now()/50)*15);
                ctx.beginPath(); ctx.arc(0,35,o,0,Math.PI); ctx.fill();
            } else {
                ctx.strokeStyle='#000'; ctx.lineWidth=3;
                ctx.beginPath(); ctx.moveTo(-10,35); ctx.quadraticCurveTo(0,42,10,35); ctx.stroke();
            }

            ctx.restore();
        },

        drawParticles() {
            if(Math.random()<0.05 && this.skin!=='default') {
                this.particles.push({x:this.dog.x+(Math.random()-0.5)*100, y:this.dog.y+(Math.random()-0.5)*100, t:'‚ú®', vx:0, vy:-1, life:1});
            }
            for(let i=this.particles.length-1; i>=0; i--) {
                let p = this.particles[i];
                p.x+=p.vx; p.y+=p.vy; p.life-=0.02;
                ctx.globalAlpha=p.life;
                if(p.t==='‚ú®') { ctx.fillStyle='gold'; ctx.fillText('‚ú¶',p.x,p.y); }
                else { ctx.font='24px Arial'; ctx.fillText(p.t,p.x,p.y); }
                ctx.globalAlpha=1;
                if(p.life<=0) this.particles.splice(i,1);
            }
        }
    };

    /** INPUT **/
    const Input = {
        x:0, y:0, drag:null,
        start(t, e) {
            e.preventDefault();
            this.drag=t;
            const g=document.getElementById('ghost');
            g.innerText=t==='caviar'?'üç±':'';
            g.style.display='block';
            this.move(e);
        },
        move(e) {
            const cx=e.touches?e.touches[0].clientX:e.clientX;
            const cy=e.touches?e.touches[0].clientY:e.clientY;
            this.x=cx; this.y=cy;
            if(this.drag) {
                const g=document.getElementById('ghost');
                g.style.left=cx+'px'; g.style.top=cy+'px';
            }
        },
        end() {
            if(!this.drag) return;
            if(Math.hypot(this.x-Game.dog.x, this.y-(Game.dog.y-50)) < 100) {
                if(this.drag==='caviar') {
                    if(Game.cash >= 50) {
                        Game.cash-=50;
                        Game.needs.food = Math.min(100, Game.needs.food+30);
                        Game.dog.scaleY=0.8; AudioSys.sfx('coin');
                        Game.particles.push({x:Game.dog.x,y:Game.dog.y-50,t:'üòã',vx:0,vy:-2,life:1});
                        UI.update(); SaveSys.save();
                    } else UI.toast("Caviar costs $50");
                }
            }
            this.drag=null;
            document.getElementById('ghost').style.display='none';
        }
    };
    window.addEventListener('pointermove',e=>Input.move(e));
    window.addEventListener('pointerup',e=>Input.end());

    const UI = {
        update() {
            document.getElementById('cash-txt').innerText = Math.floor(Game.cash).toLocaleString();
            document.getElementById('income-txt').innerText = Game.income;
            document.getElementById('fill-food').style.transform = `scaleY(${Game.needs.food/100})`;
            document.getElementById('fill-clean').style.transform = `scaleY(${Game.needs.clean/100})`;
            document.getElementById('fill-energy').style.transform = `scaleY(${Game.needs.energy/100})`;
        },
        open(id) { 
            if(id==='shop') this.renderShop();
            if(id==='travel') this.renderEstate();
            document.getElementById('modal-'+id).style.display='flex'; 
        },
        close() { document.querySelectorAll('.modal').forEach(m=>m.style.display='none'); },
        toast(m) {
            const t=document.getElementById('toast');
            t.innerText=m; t.style.opacity=1;
            setTimeout(()=>t.style.opacity=0, 2000);
        },
        renderShop() {
            const grid = document.getElementById('shop-grid');
            grid.innerHTML = `
                <div class="card ${Game.ownedAssets['miner']?'owned-item':''}" onclick="Game.buyAsset('miner', 1000, 10)">
                    <div><h4>Crypto Rig</h4><small>+10 $/sec</small></div><div class="price">$1k</div>
                </div>
                <div class="card ${Game.ownedAssets['hotel']?'owned-item':''}" onclick="Game.buyAsset('hotel', 10000, 150)">
                    <div><h4>Hotel Chain</h4><small>+150 $/sec</small></div><div class="price">$10k</div>
                </div>
                <div class="card ${Game.unlockedSkins.includes('gold')?'owned-item':''}" onclick="Game.buySkin('gold', 20000)">
                    <div><h4>Gold Skin</h4><small>24 Karat</small></div><div class="price">$20k</div>
                </div>
                <div class="card ${Game.unlockedSkins.includes('diamond')?'owned-item':''}" onclick="Game.buySkin('diamond', 100000)">
                    <div><h4>Diamond</h4><small>Indestructible</small></div><div class="price">$100k</div>
                </div>
            `;
        },
        renderEstate() {
            const grid = document.getElementById('estate-grid');
            const locs = [
                {id:'penthouse', n:'Penthouse', s:'City View', p:0},
                {id:'yacht', n:'Mega Yacht', s:'Ocean View', p:50000},
                {id:'moon', n:'Moon Base', s:'Space View', p:1000000},
                {id:'gold_room', n:'Vault', s:'Solid Gold', p:5000000}
            ];
            grid.innerHTML = locs.map(l => {
                const owned = Game.unlockedLocs.includes(l.id);
                const priceTxt = owned ? "OWNED" : "$"+(l.p/1000)+"k";
                return `<div class="card" onclick="Game.travel('${l.id}', ${l.p})">
                    <div><h4>${l.n}</h4><small>${l.s}</small></div>
                    <div class="price" style="color:${owned?'#2ecc71':'var(--gold)'}">${priceTxt}</div>
                </div>`;
            }).join('');
        }
    };

    Game.init();
</script>
</body>
</html>
