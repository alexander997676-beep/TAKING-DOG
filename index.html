<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Talking Dog: Faizan Edition</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@700&display=swap');

        :root {
            --primary: #ff6b6b;
            --accent: #4ecdc4;
            --dark: #2d3436;
            --glass: rgba(255, 255, 255, 0.85);
        }

        body {
            margin: 0; background: #2d3436; font-family: 'Nunito', sans-serif;
            overflow: hidden; height: 100vh; touch-action: none;
        }

        #app {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, #87CEEB, #E0F7FA);
            display: flex; flex-direction: column;
            transition: background 1s ease;
        }
        #app.night { background: linear-gradient(to bottom, #2c3e50, #4ca1af); }

        /* --- HUD --- */
        #hud { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; z-index: 20; }
        .badge {
            background: var(--glass); backdrop-filter: blur(10px);
            padding: 8px 16px; border-radius: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); font-weight: 800; color: var(--dark);
            display: flex; align-items: center; gap: 8px; border: 1px solid white;
        }

        /* --- STATS --- */
        .bars-container {
            position: absolute; top: 80px; left: 20px; right: 20px;
            display: flex; gap: 10px; z-index: 10;
        }
        .bar-wrap { flex: 1; height: 10px; background: rgba(0,0,0,0.1); border-radius: 5px; overflow: hidden; }
        .bar-fill { height: 100%; border-radius: 5px; transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1); }

        /* --- STAGE --- */
        #stage-container { flex-grow: 1; position: relative; cursor: grab; }
        canvas { width: 100%; height: 100%; display: block; }

        /* --- CONTROLS --- */
        #controls {
            height: 120px; /* Thoda bada kiya taaki text aa sake */
            background: rgba(255,255,255,0.9);
            border-radius: 40px 40px 0 0;
            display: flex; justify-content: space-evenly; align-items: flex-start;
            padding-top: 20px;
            padding-bottom: env(safe-area-inset-bottom, 20px);
            box-shadow: 0 -10px 50px rgba(0,0,0,0.1);
            z-index: 30;
            position: relative;
        }

        .btn {
            width: 55px; height: 55px; border: none; border-radius: 20px;
            background: #f1f2f6; font-size: 26px; box-shadow: 0 5px 0 #dfe4ea;
            transition: transform 0.1s; cursor: pointer;
        }
        .btn:active { transform: translateY(5px); box-shadow: none; }
        
        #mic-btn {
            width: 80px; height: 80px; border-radius: 50%;
            background: var(--primary); color: white; font-size: 34px; margin-top: -40px;
            box-shadow: 0 8px 0 #c0392b; border: 5px solid white;
            display: flex; justify-content: center; align-items: center;
        }
        #mic-btn.recording { animation: pulse 1s infinite; background: #ff4757; }

        /* --- FOOTER CREDIT (DESIGNER NAME) --- */
        #designer-credit {
            position: absolute;
            bottom: 5px;
            width: 100%;
            text-align: center;
            font-size: 10px;
            font-weight: 900;
            color: #FFD700; /* GOLDEN COLOR */
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
            letter-spacing: 1px;
            z-index: 40;
            pointer-events: none;
            font-family: 'Fredoka One', cursive;
            padding-bottom: env(safe-area-inset-bottom, 2px);
        }

        /* --- SHOP --- */
        #shop-overlay {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 75%;
            background: #fdfdfd; border-radius: 40px 40px 0 0;
            transform: translateY(110%); transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            z-index: 100; padding: 25px; box-sizing: border-box;
            display: flex; flex-direction: column;
            box-shadow: 0 -20px 60px rgba(0,0,0,0.2);
        }
        #shop-overlay.active { transform: translateY(0); }

        .shop-section { margin-bottom: 15px; }
        .section-title { font-size: 14px; color: #636e72; font-weight: bold; margin-bottom: 5px; text-transform: uppercase; }
        .shop-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        
        .item-card {
            background: #f1f2f6; border-radius: 15px; padding: 10px;
            text-align: center; border: 2px solid transparent; cursor: pointer;
            font-size: 12px; font-weight: bold;
        }
        .item-card img { font-size: 24px; display: block; margin: 0 auto 5px; }
        .item-card.active { border-color: var(--accent); background: #e0fbf9; box-shadow: 0 4px 10px rgba(78, 205, 196, 0.2); }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

<div id="app">
    <!-- UI -->
    <div id="hud">
        <div class="badge">ü™ô <span id="coin-txt">250</span></div>
        <div class="badge" onclick="shop.toggle()" style="cursor: pointer;">üõçÔ∏è Store</div>
    </div>

    <div class="bars-container">
        <div class="bar-wrap"><div class="bar-fill" id="bar-food" style="background:#ff9ff3; width:80%"></div></div>
        <div class="bar-wrap"><div class="bar-fill" id="bar-wash" style="background:#54a0ff; width:60%"></div></div>
        <div class="bar-wrap"><div class="bar-fill" id="bar-sleep" style="background:#00d2d3; width:90%"></div></div>
    </div>

    <!-- Canvas -->
    <div id="stage-container">
        <canvas id="cvs"></canvas>
    </div>

    <!-- Controls -->
    <div id="controls">
        <button class="btn" onclick="game.act('eat')">üçñ</button>
        <button class="btn" onclick="game.act('wash')">üßº</button>
        <div id="mic-btn">üéôÔ∏è</div>
        <button class="btn" onclick="game.spawnBall()">üéæ</button>
        <button class="btn" onclick="game.toggleSleep()">üí§</button>
        
        <!-- DESIGNER CREDIT -->
        <div id="designer-credit">DESIGNED BY MUHAMMAD FAIZAN AHMED</div>
    </div>

    <!-- Shop -->
    <div id="shop-overlay">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <h2 style="margin:0; font-family:'Fredoka One'; color:#2d3436;">Pet Store</h2>
            <button onclick="shop.toggle()" style="background:#ff7675; color:white; border:none; padding:8px 20px; border-radius:20px; font-weight:bold;">Close</button>
        </div>
        
        <div style="overflow-y:auto; flex-grow:1; padding-bottom:20px;">
            
            <!-- SKINS SECTION -->
            <div class="shop-section">
                <div class="section-title">Fur Color (Skins)</div>
                <div class="shop-grid" id="skin-list"></div>
            </div>

            <!-- ACCESSORIES SECTION -->
            <div class="shop-section">
                <div class="section-title">Accessories</div>
                <div class="shop-grid" id="acc-list"></div>
            </div>

        </div>
    </div>
</div>

<script>
    /* =========================================
       1. ENGINE
       ========================================= */
    const cvs = document.getElementById('cvs');
    const ctx = cvs.getContext('2d');
    let width, height, dpr;

    function resize() {
        width = document.getElementById('stage-container').offsetWidth;
        height = document.getElementById('stage-container').offsetHeight;
        dpr = window.devicePixelRatio || 1;
        cvs.width = width * dpr; cvs.height = height * dpr;
        ctx.scale(dpr, dpr);
    }
    window.addEventListener('resize', resize);
    const lerp = (a, b, t) => a + (b - a) * t;

    /* =========================================
       2. GAME LOGIC
       ========================================= */
    const game = {
        coins: 250,
        stats: { food: 80, wash: 80, sleep: 80 },
        isNight: false,
        dog: {
            scaleY: 1, eyeX: 0, eyeY: 0, blink: 0, anim: 'idle', timer: 0
        },
        particles: [], ball: null, input: { x:0, y:0, isDown:false },

        act(type) {
            if(type === 'eat') { this.stats.food=Math.min(100,this.stats.food+20); this.triggerAnim('happy'); this.spawnPart(width/2, height/2, 'üçñ'); audio.playTone(400); }
            if(type === 'wash') { this.stats.wash=100; this.triggerAnim('happy'); this.spawnPart(width/2, height/2, 'ü´ß'); audio.playTone(600); }
            this.updateUI();
        },
        toggleSleep() { this.isNight = !this.isNight; this.dog.anim = this.isNight?'sleep':'idle'; document.getElementById('app').className = this.isNight?'night':''; },
        spawnBall() { this.ball = { x: width/2, y: 0, vx: (Math.random()-0.5)*15, vy: 0, r: 25 }; },
        triggerAnim(n) { this.dog.anim=n; this.dog.timer=50; this.dog.scaleY=0.8; },
        spawnPart(x, y, char) { for(let i=0;i<8;i++) this.particles.push({x,y,char,vx:(Math.random()-0.5)*10,vy:(Math.random()-1)*10,life:1,size:30}); },
        updateUI() {
            document.getElementById('coin-txt').innerText = this.coins;
            document.getElementById('bar-food').style.width = this.stats.food + '%';
            document.getElementById('bar-wash').style.width = this.stats.wash + '%';
            document.getElementById('bar-sleep').style.width = this.stats.sleep + '%';
        }
    };

    /* =========================================
       3. SHOP DATA & LOGIC
       ========================================= */
    const shop = {
        skins: [
            { id: 'brown', name: 'Classic', col: ['#D7CCC8', '#8D6E63'], icon: 'üêï' },
            { id: 'black', name: 'Midnight', col: ['#636e72', '#2d3436'], icon: 'üêà‚Äç‚¨õ' },
            { id: 'gold', name: 'Goldie', col: ['#ffeaa7', '#fdcb6e'], icon: 'üèÜ' },
            { id: 'white', name: 'Cloud', col: ['#f5f6fa', '#dcdde1'], icon: 'üê©' },
            { id: 'zombie', name: 'Zombie', col: ['#b8e994', '#78e08f'], icon: 'üßü' },
            { id: 'robot', name: 'Robo-Dog', col: ['#dfe6e9', '#b2bec3'], icon: 'ü§ñ' }
        ],
        accessories: [
            { id: 'none', name: 'No Item', icon: 'üö´' },
            { id: 'shades', name: 'Shades', icon: 'üï∂Ô∏è' },
            { id: 'hat', name: 'Top Hat', icon: 'üé©' },
            { id: 'bow', name: 'Bow Tie', icon: 'üéÄ' },
            { id: 'crown', name: 'Crown', icon: 'üëë' }
        ],
        activeSkin: 0,
        activeAcc: 0,

        init() {
            // Render Skins
            const sList = document.getElementById('skin-list');
            this.skins.forEach((s, i) => {
                let div = document.createElement('div');
                div.className = `item-card ${i===0?'active':''}`;
                div.innerHTML = `<span style="font-size:20px">${s.icon}</span><br>${s.name}`;
                div.onclick = () => { this.activeSkin = i; this.renderSelection(); };
                sList.appendChild(div);
            });

            // Render Accessories
            const aList = document.getElementById('acc-list');
            this.accessories.forEach((a, i) => {
                let div = document.createElement('div');
                div.className = `item-card ${i===0?'active':''}`;
                div.innerHTML = `<span style="font-size:20px">${a.icon}</span><br>${a.name}`;
                div.onclick = () => { this.activeAcc = i; this.renderSelection(); };
                aList.appendChild(div);
            });
        },
        renderSelection() {
            // Update UI highlight
            let sCards = document.getElementById('skin-list').children;
            for(let c of sCards) c.classList.remove('active');
            sCards[this.activeSkin].classList.add('active');

            let aCards = document.getElementById('acc-list').children;
            for(let c of aCards) c.classList.remove('active');
            aCards[this.activeAcc].classList.add('active');
        },
        toggle() { document.getElementById('shop-overlay').classList.toggle('active'); }
    };

    /* =========================================
       4. AUDIO
       ========================================= */
    const audio = {
        ctx: null,
        init() { this.ctx = new (window.AudioContext || window.webkitAudioContext)(); },
        playTone(f) {
            if(!this.ctx) return;
            let o = this.ctx.createOscillator(), g = this.ctx.createGain();
            o.frequency.value = f; g.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime+0.2);
            o.connect(g); g.connect(this.ctx.destination); o.start(); o.stop(this.ctx.currentTime+0.2);
        },
        playVoice(buf) {
            if(!this.ctx) return;
            let src = this.ctx.createBufferSource();
            src.buffer = buf; src.playbackRate.value = 1.35; 
            src.connect(this.ctx.destination); src.start();
            return src;
        }
    };

    /* =========================================
       5. INPUTS
       ========================================= */
    window.onload = () => { resize(); shop.init(); audio.init(); loop(); };

    const micBtn = document.getElementById('mic-btn');
    let rec, chunks=[];
    micBtn.onpointerdown = async (e) => {
        e.preventDefault(); if(audio.ctx.state==='suspended') await audio.ctx.resume();
        try { let s = await navigator.mediaDevices.getUserMedia({audio:true}); rec=new MediaRecorder(s); chunks=[]; rec.ondataavailable=e=>chunks.push(e.data); rec.start(); micBtn.classList.add('recording'); } catch(e){}
    };
    micBtn.onpointerup = (e) => {
        e.preventDefault(); if(!rec) return; rec.stop(); micBtn.classList.remove('recording');
        rec.onstop=async()=>{ let b=new Blob(chunks,{type:'audio/ogg;codecs=opus'}); let buf=await audio.ctx.decodeAudioData(await b.arrayBuffer()); let src=audio.playVoice(buf); game.triggerAnim('talk'); src.onended=()=>game.dog.anim='idle'; };
    };

    document.getElementById('stage-container').onpointerdown = e => {
        game.input.isDown = true; game.input.x = e.clientX; game.input.y = e.clientY;
        if(game.ball) { game.ball.vy = -15; game.ball.vx = (Math.random()-0.5)*20; }
        else if (e.clientY < height/2 + 50) { // Simple tap head
             game.triggerAnim('happy'); game.spawnPart(e.clientX, e.clientY, '‚ù§Ô∏è'); audio.playTone(500);
        }
    };
    window.onpointermove = e => { game.input.x = e.clientX; game.input.y = e.clientY; };
    window.onpointerup = () => game.input.isDown = false;

    /* =========================================
       6. RENDER
       ========================================= */
    function loop() {
        ctx.clearRect(0,0,width,height);
        
        // Physics
        game.dog.scaleY = lerp(game.dog.scaleY, 1, 0.1);
        let tx = game.ball ? game.ball.x : game.input.x;
        let ty = game.ball ? game.ball.y : game.input.y;
        game.dog.eyeX = lerp(game.dog.eyeX, (tx - width/2)/15, 0.1);
        game.dog.eyeY = lerp(game.dog.eyeY, (ty - height/2)/20, 0.1);

        let cx = width/2; let cy = height * 0.65;
        
        // Shadow
        ctx.fillStyle = 'rgba(0,0,0,0.15)';
        ctx.beginPath(); ctx.ellipse(cx, cy + 90, 80 * game.dog.scaleY, 20, 0, 0, Math.PI*2); ctx.fill();

        drawDog(cx, cy);

        // Ball
        if(game.ball) {
            let b = game.ball; b.vy += 0.8; b.x += b.vx; b.y += b.vy;
            if(b.y > height - 100) { b.y = height - 100; b.vy *= -0.7; }
            if(b.x < 0 || b.x > width) b.vx *= -1;
            ctx.save(); ctx.translate(b.x, b.y); ctx.fillStyle = '#badc58'; ctx.beginPath(); ctx.arc(0,0,b.r,0,Math.PI*2); ctx.fill(); ctx.strokeStyle='white'; ctx.stroke(); ctx.restore();
        }

        // Particles
        for(let i=game.particles.length-1; i>=0; i--) {
            let p = game.particles[i]; p.x+=p.vx; p.y+=p.vy; p.vy+=0.5; p.life-=0.02;
            ctx.globalAlpha=p.life; ctx.font=`${p.size}px Arial`; ctx.fillText(p.char, p.x, p.y);
            ctx.globalAlpha=1; if(p.life<=0) game.particles.splice(i,1);
        }

        if(game.dog.timer>0) { game.dog.timer--; if(game.dog.timer<=0) game.dog.anim='idle'; }
        requestAnimationFrame(loop);
    }

    function drawDog(x, y) {
        ctx.save(); ctx.translate(x, y);
        ctx.scale(1/game.dog.scaleY, game.dog.scaleY);

        let skin = shop.skins[shop.activeSkin].col;
        let acc = shop.accessories[shop.activeAcc].id;
        let breath = Math.sin(Date.now()/500)*3;
        if(game.dog.anim === 'talk') breath = Math.sin(Date.now()/50)*5;

        // Body
        let grad = ctx.createLinearGradient(-50, -100, 50, 100);
        grad.addColorStop(0, skin[0]); grad.addColorStop(1, skin[1]);
        
        // Tail
        ctx.strokeStyle = skin[1]; ctx.lineWidth = 15; ctx.lineCap = 'round';
        let wag = (game.dog.anim==='happy'||game.dog.anim==='talk')?Math.sin(Date.now()/50)*30:0;
        ctx.beginPath(); ctx.moveTo(40,40); ctx.quadraticCurveTo(70,20,70+wag,-20); ctx.stroke();

        ctx.fillStyle = grad; ctx.beginPath(); ctx.ellipse(0, 50, 65, 75+breath, 0, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = 'rgba(255,255,255,0.3)'; ctx.beginPath(); ctx.ellipse(0, 60, 40, 45+breath, 0, 0, Math.PI*2); ctx.fill();

        // Head Group
        ctx.translate(0, -60+breath);
        
        // Ears
        ctx.fillStyle = skin[1];
        ctx.beginPath(); ctx.moveTo(-50, -20); ctx.bezierCurveTo(-100, 0, -90, 80, -50, 50); ctx.fill();
        ctx.beginPath(); ctx.moveTo(50, -20); ctx.bezierCurveTo(100, 0, 90, 80, 50, 50); ctx.fill();

        // Face
        ctx.fillStyle = grad; ctx.beginPath(); ctx.arc(0, 0, 70, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = '#fff'; ctx.beginPath(); ctx.ellipse(0, 25, 40, 32, 0, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = '#2d3436'; ctx.beginPath(); ctx.arc(0, 15, 12, 0, Math.PI*2); ctx.fill();

        // Eyes
        let blink = (Math.random()<0.01 || game.dog.anim==='sleep') ? 0 : 1;
        ctx.fillStyle = 'white';
        ctx.beginPath(); ctx.ellipse(-25, -15, 16, 18*blink, 0, 0, Math.PI*2); ctx.fill();
        ctx.beginPath(); ctx.ellipse(25, -15, 16, 18*blink, 0, 0, Math.PI*2); ctx.fill();
        
        if(blink) {
            let px = Math.max(-8, Math.min(8, game.dog.eyeX));
            let py = Math.max(-8, Math.min(8, game.dog.eyeY));
            ctx.fillStyle = '#2d3436';
            ctx.beginPath(); ctx.arc(-25+px, -15+py, 7, 0, Math.PI*2); ctx.fill();
            ctx.beginPath(); ctx.arc(25+px, -15+py, 7, 0, Math.PI*2); ctx.fill();
        }

        // ACCESSORIES RENDER
        if(acc === 'shades') {
            ctx.fillStyle = '#222'; ctx.fillRect(-50, -25, 45, 25); ctx.fillRect(5, -25, 45, 25);
            ctx.strokeStyle = '#222'; ctx.lineWidth=3; ctx.beginPath(); ctx.moveTo(-5,-20); ctx.lineTo(5,-20); ctx.stroke();
        }

        if(acc === 'hat') {
            ctx.fillStyle = '#2d3436'; ctx.fillRect(-45, -90, 90, 60); ctx.fillRect(-70, -30, 140, 10);
            ctx.fillStyle = '#d63031'; ctx.fillRect(-45, -45, 90, 10);
        }

        if(acc === 'crown') {
            ctx.fillStyle = '#f1c40f'; 
            ctx.beginPath(); ctx.moveTo(-40, -50); ctx.lineTo(-20, -90); ctx.lineTo(0, -50); ctx.lineTo(20, -90); ctx.lineTo(40, -50); ctx.lineTo(40, -30); ctx.lineTo(-40, -30); ctx.fill();
        }

        // Mouth
        ctx.fillStyle = '#ff7675';
        if(game.dog.anim==='talk'||game.dog.anim==='happy') {
            ctx.beginPath(); ctx.arc(0, 40, 15, 0, Math.PI); ctx.fill();
        } else {
            ctx.strokeStyle='#2d3436'; ctx.lineWidth=3;
            ctx.beginPath(); ctx.moveTo(0,35); ctx.lineTo(0,45); ctx.moveTo(0,45); ctx.quadraticCurveTo(-15,45,-20,35); ctx.moveTo(0,45); ctx.quadraticCurveTo(15,45,20,35); ctx.stroke();
        }

        // Bow Tie (Neck)
        if(acc === 'bow') {
            ctx.fillStyle = '#e17055'; 
            ctx.beginPath(); ctx.moveTo(0, 60); ctx.lineTo(-20, 50); ctx.lineTo(-20, 70); ctx.fill();
            ctx.beginPath(); ctx.moveTo(0, 60); ctx.lineTo(20, 50); ctx.lineTo(20, 70); ctx.fill();
            ctx.beginPath(); ctx.arc(0, 60, 5, 0, Math.PI*2); ctx.fill();
        } else {
            // Standard Collar
            ctx.fillStyle = '#ff6b6b'; ctx.fillRect(-40, 55, 80, 12);
            ctx.fillStyle = '#feca57'; ctx.beginPath(); ctx.arc(0, 65, 8, 0, Math.PI*2); ctx.fill();
        }

        ctx.restore();
    }
</script>
</body>
</html>
